<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Account Linking FAQ  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    <style> table {border: thin solid black; border-spacing: 0px} td {border: thin solid black; padding: 5px} </style>
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="Account Linking FAQ  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          BlinkEReceipt extension SDK 2.34.0 Docs
        </a>
        
      </p>
    
      <div class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </div>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/BlinkReceipt/blinkereceipt-ios">
            <img class="header-icon" src="img/gh.png" alt="GitHub"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">BlinkEReceipt extension SDK Reference</a>
      <img class="carat" src="img/carat.png" alt=""/>
      Account Linking FAQ  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="account-linking.html">Account Linking</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="account-linking-faq.html">Account Linking FAQ</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="account-linking-samples.html">Account Linking Samples</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="e-receipt-parsing.html">E-Receipt Parsing</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BRAccountLinkingConfiguration.html">BRAccountLinkingConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BRAccountLinkingConnection.html">BRAccountLinkingConnection</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BRAccountLinkingConnectionIdentifier.html">BRAccountLinkingConnectionIdentifier</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BRAccountLinkingCredentials.html">BRAccountLinkingCredentials</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BRAccountLinkingManager.html">BRAccountLinkingManager</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BREReceiptManager.html">BREReceiptManager</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BREmailAccount.html">BREmailAccount</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BRIMAPAccount.html">BRIMAPAccount</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BRAccountLinkingError.html">BRAccountLinkingError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BRAccountLinkingRetailer.html">BRAccountLinkingRetailer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BREReceiptIMAPError.html">BREReceiptIMAPError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BREReceiptProvider.html">BREReceiptProvider</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BREReceiptRemoteError.html">BREReceiptRemoteError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BRSetupIMAPResult.html">BRSetupIMAPResult</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <h1 id='account-linking-faq' class='heading'>Account Linking FAQ</h1>

<p>This guide provides answers to FAQs.</p>
<h2 id='frequently-asked-questions' class='heading'>Frequently asked questions</h2>
<h4 id='can-account-linking-handle-accounts-with-2fa-captcha-or-other-authentication-challenges' class='heading'>Can Account Linking handle accounts with 2FA, CAPTCHA or other authentication challenges?</h4>

<p>Sometimes the user&rsquo;s input is required to successfully log in to a retailer account. This can happen when the user has 2FA enabled for an account, or when the retailer shows a CAPTCHA for extra verification, or in various other situations.</p>

<p>For both <code>verifyRetailer</code> and <code>grabNewOrders</code> this is handled in the same way:</p>

<ul>
<li><p>The <code><a href="Enums/BRAccountLinkingError.html">BRAccountLinkingError</a></code> will indicate the stages of this process</p></li>
<li><p><code>BRAccountLinkingErrorVerificationNeeded</code> indicates that the SDK has encountered a page that requires the user&rsquo;s input. The <code>UIViewController</code> parameter of the callback will be populated with the view controller that you should display</p></li>
<li><p><code>BRAccountLinkingErrorVerificationCompleted</code> indicates that the user successfully authenticated and you should now dismiss the view controller (note that the <code>UIViewController</code> callback parameter will be <code>nil</code> in this case but you do not need it to dismiss a presented modal, simply call, e.g. <code>self.dismiss(animated: false)</code>)</p></li>
</ul>

<p>Example:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">taskId</span> <span class="o">=</span> <span class="kt">BRAccountLinkingManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">grabNewOrders</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">walmart</span><span class="p">)</span> <span class="p">{</span> <span class="n">retailer</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">remaining</span><span class="p">,</span> <span class="n">viewController</span><span class="p">,</span> <span class="n">errorCode</span><span class="p">,</span> <span class="n">sessionID</span> <span class="k">in</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">errorCode</span> <span class="o">==</span> <span class="o">.</span><span class="n">verificationNeeded</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="n">viewController</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">errorCode</span> <span class="o">==</span> <span class="o">.</span><span class="n">verificationCompleted</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">errorCode</span> <span class="o">==</span> <span class="o">.</span><span class="k">none</span> <span class="p">{</span>
    <span class="c1">// Order may be returned here         </span>
    <span class="k">if</span> <span class="p">(</span><span class="n">remaining</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Grab Orders Completed Successfully</span>
      <span class="c1">// No more orders to fetch</span>
    <span class="p">}</span>            
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Grab Orders Failed. Check error for more info</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<hr>
<h4 id='can-i-execute-account-linking-from-a-background-thread' class='heading'>Can I execute Account Linking from a background thread?</h4>

<p>Account Linking is not thread safe so we recommend all execution is done on the <strong>main</strong> thread.</p>

<hr>
<h4 id='can-i-link-multiple-accounts-for-the-same-retailer' class='heading'>Can I link multiple accounts for the same retailer?</h4>

<p>Linking multiple accounts for the same merchant is not supported. You have to unlink the account first before you link a different one for the same retailer.</p>

<hr>
<h4 id='can-i-change-user-39-s-credentials' class='heading'>Can I change user&rsquo;s credentials?</h4>

<p>Modifying user&rsquo;s credentials is not allowed after the <a href="https://blinkreceipt.github.io/blinkereceipt-ios/Classes/BRAccountLinkingConnection.html">BRAccountLinkingConnection</a> object is created. In order for you to change the credentials, you have to unlink the account first and then create and link new connection with different credentials.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">username</span> <span class="o">=</span> <span class="s">"user 1"</span>
<span class="k">let</span> <span class="nv">password</span> <span class="o">=</span> <span class="s">"pass 1"</span>
<span class="k">let</span> <span class="nv">connection</span> <span class="o">=</span> <span class="kt">BRAccountLinkingConnection</span><span class="p">(</span><span class="nv">retailer</span><span class="p">:</span> <span class="o">.</span><span class="n">walmart</span><span class="p">,</span> <span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="n">password</span><span class="p">)</span>
<span class="kt">BRAccountLinkingManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">linkRetailer</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">connection</span><span class="p">)</span>

<span class="kt">BRAccountLinkingManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">unlinkAccount</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">walmart</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">conn</span> <span class="o">=</span> <span class="kt">BRAccountLinkingConnection</span><span class="p">(</span><span class="nv">retailer</span><span class="p">:</span> <span class="o">.</span><span class="n">walmart</span><span class="p">,</span> <span class="nv">username</span><span class="p">:</span> <span class="s">"user 2"</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="s">"pass 2"</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">dayCutoff</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="kt">BRAccountLinkingManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">linkRetailer</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">conn</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<div class="aside aside-note">
    <p class="aside-title">Note</p>
    <p>It is recommended to call <a href="https://blinkreceipt.github.io/blinkereceipt-ios/Classes/BRAccountLinkingManager.html#/c:objc(cs)BRAccountLinkingManager(im)verifyRetailerWithConnection:withCompletion:">verifyRetailer</a> before linking if unsure the credentials are valid</p>

</div>

<hr>
<h4 id='a-href-https-blinkreceipt-github-io-blinkereceipt-ios-classes-braccountlinkingmanager-html-c-objc-cs-braccountlinkingmanager-im-grabnewordersforretailer-withcompletion-grabneworders-a-returns-success-but-i-don-39-t-see-any-of-my-orders' class='heading'><a href="https://blinkreceipt.github.io/blinkereceipt-ios/Classes/BRAccountLinkingManager.html#/c:objc(cs)BRAccountLinkingManager(im)grabNewOrdersForRetailer:withCompletion:">grabNewOrders</a> returns success but i don&rsquo;t see any of my orders!</h4>

<p>The most common reasons for that are:</p>

<ul>
<li>Make sure your connection <a href="https://blinkreceipt.github.io/blinkereceipt-ios/Classes/BRAccountLinkingConfiguration.html#/c:objc(cs)BRAccountLinkingConfiguration(py)dayCutoff">dayCutoff</a> or <a href="https://blinkreceipt.github.io/blinkereceipt-ios/Classes/BRAccountLinkingConfiguration.html#/c:objc(cs)BRAccountLinkingConfiguration(py)dateCutoff">dateCutoff</a> is large enough to capture your orders. You can verify that by login in your web account and verifying that you have purchases newer than your <code>dayCutoff</code>.</li>
<li>Have you tried resetting the <a href="https://blinkreceipt.github.io/blinkereceipt-ios/Classes/BRAccountLinkingManager.html#/c:objc(cs)BRAccountLinkingManager(im)resetHistoryForRetailer:">orders history</a>? Very often developers forget to reset the cache while testing. By default the SDK maintains an internal date of the last successful search for each retailer so that each time you attempt to retrieve new messages, you will only get messages since the last successful check, and subject to the day cutoff that you set (default is 15 days).<br /></li>
</ul>

<p>You can also reach out to us at <a href="mailto:support@microblink.com">support@microblink.com</a>, if you are still not seeing orders after trying the steps above.</p>
<div class="aside aside-note">
    <p class="aside-title">Note</p>
    <p>Unlinking account won&rsquo;t reset the user&rsquo;s cache if the same user is linked again. To make sure the cache is removed, you must call  <code>BRAccountLinkingManager.shared().resetHistory(for: .walmart)</code> for your retailer</p>

</div>

<hr>
<h4 id='can-i-fetch-in-store-orders-with-account-linking' class='heading'>Can I fetch In-Store orders with Account Linking?</h4>

<p>Yes, Account Linking supports <code>In-Store</code> purchases as long as they are visible in your account on the web. Please check your retailer&rsquo;s guidelines on how to link your <code>In-Store</code> purchases so they appear in your web account.</p>
<div class="aside aside-note">
    <p class="aside-title">Note</p>
    <p>Target, Walmart, Kroger are just few of the popular merchants that allow their customers to see their <code>In-Store</code> purchases on the web. </p>

</div>

<hr>
<h4 id='what-order-types-account-linking-supports' class='heading'>What order types Account Linking supports?</h4>

<p>Account Linking supports 5 <a href="https://blinkreceipt.github.io/blinkreceipt-ios/Classes/BRScanResults.html#/c:objc(cs)BRScanResults(py)purchaseType">order types</a>:</p>

<ol>
<li><strong>In-Store</strong> - Purchases done in store.</li>
<li><strong>Delivery</strong> - Purchases that are shipped to the customer.<br></li>
<li><strong>Pickup</strong> - Online purchases, picked in store by the customer.</li>
<li><strong>Digital</strong> - movies, eBooks, etc&hellip;</li>
<li><strong>Subscription</strong></li>
</ol>

<hr>
<h4 id='does-account-linking-return-an-order-status-of-my-purchases' class='heading'>Does Account Linking return an order status of my purchases?</h4>

<p>Account Linking supports 6 status values: <code>cancelled</code>, <code>refunded</code>, <code>returned</code>, <code>completed</code>, <code>shipped</code>, <code>ordered</code>. Depending on the retailer and the order type you may see these values populated in one of the following places:</p>

<ol>
<li><a href="https://blinkreceipt.github.io/blinkreceipt-ios/Classes/BRScanResults.html#/c:objc(cs)BRScanResults(py)ereceiptOrderStatus">Order status</a> - A status representing the whole order</li>
<li><a href="https://blinkreceipt.github.io/blinkreceipt-ios/Classes/BRShipment.html#/c:objc(cs)BRShipment(py)status">Shipment status</a> - A status representing a single shipment. Available for <code>Delivery</code> orders only</li>
<li><a href="https://blinkreceipt.github.io/blinkreceipt-ios/Classes/BRProduct.html#/c:objc(cs)BRProduct(py)shippingStatus">Product status</a> - A status for a single product.</li>
</ol>

<hr>
<h4 id='is-account-linking-going-to-return-a-previously-fetched-order-if-its-status-changes-from-shipped-to-delivered' class='heading'>Is Account Linking going to return a previously fetched order, if its status changes from shipped to delivered?</h4>

<p>Account Linking only returns an order once. To get the most recent version of an order you have to re-scrape the order by resetting the order history.</p>
<pre class="highlight swift"><code><span class="kt">BRAccountLinkingManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">resetHistory</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">walmart</span><span class="p">)</span>
</code></pre>

<hr>
<h4 id='how-does-account-linking-handles-the-user-s-credentials' class='heading'>How does Account Linking handles the user’s credentials?</h4>

<p>All credentials are stored locally on device&rsquo;s keychain. They don&rsquo;t leave the device and are only used by Account Linking, if authentication is required.</p>

<hr>
<h4 id='what-data-should-i-expect-from-account-linking' class='heading'>What data should I expect from Account Linking?</h4>

<p>Account Linking returns orders as <a href="https://blinkreceipt.github.io/blinkreceipt-ios/Classes/BRScanResults.html">BRScanResult</a> objects. You may see different properties of that object populated with values, depending on the retailer and the order type. For example: A <code>In-Store</code> order would return a list with <a href="https://blinkreceipt.github.io/blinkreceipt-ios/Classes/BRScanResults.html#/c:objc(cs)BRScanResults(py)products">BRProducts</a> in its <code>products</code> property, while a <code>Delivery</code> order would have the <code>shipments</code> property populated with <a href="https://blinkreceipt.github.io/blinkreceipt-ios/Classes/BRScanResults.html#/c:objc(cs)BRScanResults(py)shipments">BRShipment</a> objects. See order examples <a href="https://blinkreceipt.github.io/blinkereceipt-ios/account-linking-samples.html">here</a></p>
<div class="aside aside-note">
    <p class="aside-title">Note</p>
    <p>We recommend our clients support all fields they care about despite not seeing values at the moment for some of the retailers. That way they may benefit from any OTA updates down the road without the need to submit a new app update.</p>

</div>

<hr>
<h4 id='how-frequent-does-the-background-fetch-executes' class='heading'>How frequent does the background fetch executes?</h4>

<p>Although our background job is scheduled to run every hour, it is up to the device (OS) to decide if a background task should be executed or not. </p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2023 <a class="link" href="https://www.blinkreceipt.com" target="_blank" rel="external noopener">BlinkReceipt LLC</a>. All rights reserved. (Last updated: 2023-12-18)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external noopener">jazzy ♪♫ v0.14.3</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external noopener">Realm</a> project.</p>
    </section>
  </body>
</html>
