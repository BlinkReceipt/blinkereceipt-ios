<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Account Linking  Reference</title>
    <link rel="icon" href="https://microblink.com/wp-content/uploads/2022/01/cropped-Microblink_Favicon-32x32.png" sizes="32x32" />
    <link rel="icon" href="https://microblink.com/wp-content/uploads/2022/01/cropped-Microblink_Favicon-192x192.png" sizes="192x192" />
    <link rel="apple-touch-icon" href="https://microblink.com/wp-content/uploads/2022/01/cropped-Microblink_Favicon-180x180.png" />
    <link rel="preload" as="font"
        href="https://microblink.com/wp-content/themes/microblink/assets/fonts/satoshi-bold-webfont.woff2" crossorigin>
    <link rel="preload" as="font"
        href="https://microblink.com/wp-content/themes/microblink/assets/fonts/satoshi-regular-webfont.woff2"
        crossorigin>
    <link rel="preload" as="font"
        href="https://microblink.com/wp-content/themes/microblink/assets/fonts/satoshi-medium-webfont.woff2"
        crossorigin>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <link rel="stylesheet" type="text/css" href="css/prism.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/jazzy.js" defer></script>
    <style> table {border: thin solid black; border-spacing: 0px} td {border: thin solid black; padding: 5px} </style>
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="Account Linking  Reference"></a>

    <header class="header">
      <p class="header-col">
        <img weight="20" height="20" src="https://microblink.com/wp-content/themes/microblink/assets/images/microblink-logo-animated.webp"/>
      </p>
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          BlinkEReceipt extension SDK 2.48.0 Docs
        </a>
        
      </p>
    
      <div class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </div>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/BlinkReceipt/blinkereceipt-ios">
            <img class="header-icon" src="img/gh.png" alt="GitHub"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">BlinkEReceipt extension SDK</a>
      <img class="carat" src="img/carat.png" alt=""/>
      <a class="breadcrumb" href="Guides.html">Guides</a>
      <img class="carat" src="img/carat.png" alt=""/>
      Account Linking  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="account-linking.html">Account Linking</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="account-linking-faq.html">Account Linking FAQ</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="account-linking-retailers.html">Account Linking Retailers</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="e-receipt-parsing.html">E-Receipt Parsing</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="release-notes.html">Release Notes</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="sample-responses.html">Sample Responses</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BRAccountLinkingConfiguration.html">BRAccountLinkingConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BRAccountLinkingConnection.html">BRAccountLinkingConnection</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BRAccountLinkingConnectionIdentifier.html">BRAccountLinkingConnectionIdentifier</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BRAccountLinkingCredentials.html">BRAccountLinkingCredentials</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BRAccountLinkingManager.html">BRAccountLinkingManager</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BREReceiptManager.html">BREReceiptManager</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BREmailAccount.html">BREmailAccount</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BRIMAPAccount.html">BRIMAPAccount</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BRAccountLinkingError.html">BRAccountLinkingError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BRAccountLinkingRetailer.html">BRAccountLinkingRetailer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BREReceiptIMAPError.html">BREReceiptIMAPError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BREReceiptProvider.html">BREReceiptProvider</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BREReceiptRemoteError.html">BREReceiptRemoteError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BRSetupIMAPResult.html">BRSetupIMAPResult</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <style>
  .aside-note {
    color: #155724;
    background-color: #d4edda;
    border-color: #c3e6cb; 
    padding: .75rem 1.25rem;
    margin-bottom: 1rem;
    border: 1px solid transparent;
    border-radius: .25rem; 
  }
  .aside-note > p > code {
    font-weight: bold;
    background: none;
    padding: 0;
  }

  .aside-note > p {
    margin: 0 0 5px;
  }

</style>
<h1 id='account-linking' class='heading'>Account Linking</h1>

<p>This guide provides a brief overview for how to get started using <code>Account Linking</code>.</p>
<h2 id='initialize-the-sdk' class='heading'>Initialize the SDK</h2>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">BlinkReceipt</span>
<span class="kd">import</span> <span class="kt">BlinkEReceipt</span>

<span class="kd">@main</span>
<span class="kd">class</span> <span class="kt">AppDelegate</span><span class="p">:</span> <span class="kt">UIResponder</span><span class="p">,</span> <span class="kt">UIApplicationDelegate</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="nv">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplication</span><span class="o">.</span><span class="kt">LaunchOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="kt">BRScanManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="n">licenseKey</span> <span class="o">=</span> <span class="s">"YOUR-LICENSE-KEY"</span>
        <span class="kt">BRScanManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="n">prodIntelKey</span> <span class="o">=</span> <span class="s">"YOUR-PROD-INTEL-KEY"</span>
        <span class="kt">BRAccountLinkingManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre>
<div class="aside aside-note">
    <p class="aside-title">Note</p>
    <p>A <code>licenseKey</code> or <code>prodIntelKey</code> can be obtained by emailing <a href="mailto:blinkreceipt@microblink.com">blinkreceipt@microblink.com</a>.</p>

</div>

<p><hr style="height: 2px; margin-top: 40px; margin-bottom: 40px; background-color: rgba(121, 121, 121, 1);" /></p>
<h2 id='create-account-connection' class='heading'>Create account connection</h2>

<p>Account Linking offers two UI/UX experiences when linking and verifying a merchant’s connection.</p>
<h4 id='1-host-app-authentication' class='heading'>1. Host App Authentication</h4>

<p>Using this flow, a host app can provide a native prompt for users to populate credentials. All other interactions with the merchant are done with the webview hidden in a background with exception when 2FA, Captcha or other user input is required.</p>

<p>Use collected credentials to create BRAccountLinkingConnection object.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">username</span> <span class="o">=</span> <span class="s">"user@domain.com"</span>
<span class="k">let</span> <span class="nv">password</span> <span class="o">=</span> <span class="s">"secure-password"</span>
<span class="k">let</span> <span class="nv">connection</span> <span class="o">=</span> <span class="kt">BRAccountLinkingConnection</span><span class="p">(</span><span class="nv">retailer</span><span class="p">:</span> <span class="o">.</span><span class="n">walmart</span><span class="p">,</span> <span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="n">password</span><span class="p">)</span>
<span class="n">connection</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">dayCutoff</span> <span class="o">=</span> <span class="mi">30</span>
</code></pre>
<h4 id='2-retailer-webview-authentication' class='heading'>2. Retailer Webview Authentication</h4>

<p>This flow eliminates the need for a host app to provide any native UX to collect credentials. Instead, the SDK presents a webview with the merchant’s regular authentication protocol. The webview stays populated as the user completes whatever authentication flow is required by the merchant. The webview disappears after a successful authentication is complete.</p>

<p>Create BRAccountLinkingConnection object by only specifying the retailer</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">connection</span> <span class="o">=</span> <span class="kt">BRAccountLinkingConnection</span><span class="p">(</span><span class="nv">retailer</span><span class="p">:</span> <span class="o">.</span><span class="n">walmart</span><span class="p">)</span>
<span class="n">connection</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">dayCutoff</span> <span class="o">=</span> <span class="mi">30</span>
</code></pre>

<p>Already linked connections can be switched back and forth by updating the webviewAuthEnabled value</p>
<pre class="highlight swift"><code><span class="k">if</span> <span class="k">let</span> <span class="nv">connection</span> <span class="o">=</span> <span class="kt">BRAccountLinkingManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">getLinkedRetailerConnection</span><span class="p">(</span><span class="o">.</span><span class="n">walmart</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">connection</span><span class="o">.</span><span class="n">webviewAuthEnabled</span> <span class="o">=</span> <span class="kc">true</span> <span class="c1">// Enable `Retailer Webview Authentication`</span>
  <span class="n">connection</span><span class="o">.</span><span class="n">webviewAuthEnabled</span> <span class="o">=</span> <span class="kc">false</span> <span class="c1">// Disable `Retailer Webview Authentication`</span>
  <span class="kt">BRAccountLinkingManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">update</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<h2 id='link-a-connection' class='heading'>Link a connection</h2>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="kt">BRAccountLinkingManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">linkRetailer</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">connection</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="o">.</span><span class="k">none</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Success</span>
<span class="p">}</span>
</code></pre>

<p><hr style="height: 2px; margin-top: 40px; margin-bottom: 40px; background-color: rgba(121, 121, 121, 1);" /></p>
<h2 id='verifying-a-connection' class='heading'>Verifying a connection</h2>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">username</span> <span class="o">=</span> <span class="s">"user@domain.com"</span>
<span class="k">let</span> <span class="nv">password</span> <span class="o">=</span> <span class="s">"secure-password"</span>
<span class="k">let</span> <span class="nv">connection</span> <span class="o">=</span> <span class="kt">BRAccountLinkingConnection</span><span class="p">(</span><span class="nv">retailer</span><span class="p">:</span> <span class="o">.</span><span class="n">walmart</span><span class="p">,</span> <span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="n">password</span><span class="p">)</span>
<span class="n">connection</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">dayCutoff</span> <span class="o">=</span> <span class="mi">30</span>
<span class="k">let</span> <span class="nv">taskId</span> <span class="o">=</span> <span class="kt">BRAccountLinkingManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">verifyRetailer</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">connection</span><span class="p">,</span> <span class="nv">withCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">error</span><span class="p">,</span> <span class="n">viewController</span><span class="p">,</span> <span class="n">sessionId</span> <span class="k">in</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="o">.</span><span class="n">verificationNeeded</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Display UIViewController for 2FA verification, CAPTCHA or other user input</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="o">.</span><span class="n">verificationCompleted</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Dismiss the previously presented UIViewController</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="o">.</span><span class="n">noCredentials</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Error: Credentials have not been provided</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="o">.</span><span class="kd">internal</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Error: Unexpected error</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="o">.</span><span class="n">parsingFail</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Error: General error</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="o">.</span><span class="n">invalidCredentials</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Error: Probable cause of the failure is invalid credentials</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="o">.</span><span class="n">cancelled</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Operation has been cancelled.</span>
      <span class="c1">// Dismiss any previously presented user input UIViewController</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="o">.</span><span class="n">webViewClosed</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Operation has been terminated due to dismissing of the webview.</span>
      <span class="c1">// Dismiss any previously presented user input UIViewController</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="o">.</span><span class="n">unsupportedRetailer</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Error: An attempt to verify account with invalid retailer</span>
    <span class="p">}</span>
    <span class="c1">// Verification completed successfully</span>
    <span class="c1">// Account can be linked</span>
    <span class="kt">BRAccountLinkingManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">linkRetailer</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">connection</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<p><hr style="height: 2px; margin-top: 40px; margin-bottom: 40px; background-color: rgba(121, 121, 121, 1);" /></p>
<h2 id='grab-new-orders' class='heading'>Grab New Orders</h2>

<p>Once credentials are verified and a retailer is linked, we will search for purchases in a user&rsquo;s account.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">taskId</span> <span class="o">=</span> <span class="kt">BRAccountLinkingManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">grabNewOrders</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">walmart</span><span class="p">)</span> <span class="p">{</span> <span class="n">retailer</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">remaining</span><span class="p">,</span> <span class="n">viewController</span><span class="p">,</span> <span class="n">errorCode</span><span class="p">,</span> <span class="n">sessionID</span> <span class="k">in</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">errorCode</span> <span class="o">==</span> <span class="o">.</span><span class="n">verificationNeeded</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Display UIViewController for 2FA verification, CAPTCHA or other user input</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">errorCode</span> <span class="o">==</span> <span class="o">.</span><span class="n">verificationCompleted</span> <span class="p">{</span>
    <span class="c1">// Dismiss the previously presented UIViewController</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">errorCode</span> <span class="o">==</span> <span class="o">.</span><span class="k">none</span> <span class="p">{</span>
    <span class="c1">// Orders will be returned here         </span>
    <span class="k">if</span> <span class="p">(</span><span class="n">remaining</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Grab Orders completed successfully</span>
      <span class="c1">// No more orders to fetch</span>
    <span class="p">}</span>            
  <span class="p">}</span>  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="o">.</span><span class="n">webViewClosed</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Operation has been terminated due to dismissing of the webview.</span>
    <span class="c1">// Dismiss any previously presented user input UIViewController</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="o">.</span><span class="n">unsupportedRetailer</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Error: An attempt to verify account with invalid retailer</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Grab Orders Failed. Check error for more info</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="aside aside-note">
    <p class="aside-title">Note</p>
    <p>The SDK will maintain an internal date of the last successful search for each retailer so that each time you attempt to retrieve new messages, you will only get messages since the last successful check, and subject to the day cutoff that you set (default is 15 days).</p>

</div>

<p><hr style="height: 2px; margin-top: 40px; margin-bottom: 40px; background-color: rgba(121, 121, 121, 1);" /></p>
<h2 id='grab-new-orders-app-in-background' class='heading'>Grab New Orders (App In Background)</h2>

<p>Account Linking also provides an option for apps to periodically check for new orders while the app is in background. Follow the steps below if you want to enable background fetch in your app.</p>

<ul>
<li><p>Create task identifier by adding background task support in your app. More info <a href="https://developer.apple.com/documentation/uikit/app_and_environment/scenes/preparing_your_ui_to_run_in_the_background/using_background_tasks_to_update_your_app?language=objc">here</a></p></li>
<li><p>Enable background fetch by using the task identifier from step 1</p>
<pre class="highlight swift"><code><span class="kt">BRAccountLinkingManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">enableBackgroundFetch</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="n">taskIdentifier</span><span class="p">)</span>
</code></pre></li>
<li><p>Implement <code>backgroundFetchCompletion</code> callback so the app can receive messages from the background job</p>
<pre class="highlight swift"><code><span class="kt">BRAccountLinkingManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="n">backgroundFetchCompletion</span> <span class="o">=</span> <span class="p">{</span> <span class="n">retailer</span><span class="p">,</span> <span class="n">errorCode</span><span class="p">,</span> <span class="n">sessionId</span><span class="p">,</span> <span class="n">order</span> <span class="k">in</span> <span class="p">}</span>
</code></pre></li>
</ul>

<p>Example:</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">BlinkReceipt</span>
<span class="kd">import</span> <span class="kt">BlinkEReceipt</span>

<span class="kd">@main</span>
<span class="kd">class</span> <span class="kt">AppDelegate</span><span class="p">:</span> <span class="kt">UIResponder</span><span class="p">,</span> <span class="kt">UIApplicationDelegate</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="nv">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplication</span><span class="o">.</span><span class="kt">LaunchOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="kt">BRScanManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="n">licenseKey</span> <span class="o">=</span> <span class="s">"YOUR-LICENSE-KEY"</span>
        <span class="kt">BRScanManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="n">prodIntelKey</span> <span class="o">=</span> <span class="s">"YOUR-PROD-INTEL-KEY"</span>

        <span class="c1">// Enable background fetch</span>
        <span class="k">let</span> <span class="nv">taskIdentifier</span> <span class="o">=</span> <span class="s">"Host App Background Task Identifier"</span>
        <span class="kt">BRAccountLinkingManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="nf">enableBackgroundFetch</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="n">taskIdentifier</span><span class="p">)</span>

        <span class="c1">// Background fetch callback </span>
        <span class="kt">BRAccountLinkingManager</span><span class="o">.</span><span class="nf">shared</span><span class="p">()</span><span class="o">.</span><span class="n">backgroundFetchCompletion</span> <span class="o">=</span> <span class="p">{</span> <span class="n">retailer</span><span class="p">,</span> <span class="n">errorCode</span><span class="p">,</span> <span class="n">sessionId</span><span class="p">,</span> <span class="n">order</span> <span class="k">in</span>
          <span class="c1">// Same flow as Grab Orders above</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre>
<h2 id='migration-from-code-bramazonmanager-code' class='heading'>Migration from <code>BRAmazonManager</code></h2>

<p>If you had previously integrated Amazon parsing, you will find that <code>BRAmazonManager</code> is no longer accessible in the BlinkEReceipt SDK. Instead, Amazon has been incorporated into Account Linking.</p>

<p>Here is a table detailing the functionality from the previous Amazon integration and how to achieve the same thing in the new framework:</p>

<table><thead>
<tr>
<th>Old Amazon Integration</th>
<th>New Account Linking Integration</th>
</tr>
</thead><tbody>
<tr>
<td><code>BRAmazonManager.amazonDayCutoff</code></td>
<td><code>BRAccountLinkingConnection.configuration.dayCutoff</code></td>
</tr>
<tr>
<td><code>[BRAmazonManager storeCredentials:password:]</code></td>
<td>Create a <code><a href="Classes/BRAccountLinkingConnection.html">BRAccountLinkingConnection</a></code> object and link with <code>BRAccountLinkingManager.shared().linkRetailer(with: connection)</code></td>
</tr>
<tr>
<td><code>[BRAmazonManager clearAmazonCredentials]</code></td>
<td>Call <code>BRAccountLinkingManager.shared().unlinkAccount(for: .amazon, withCompletion: {})</code></td>
</tr>
<tr>
<td><code>[BRAmazonManager hasCredentials]</code></td>
<td>Call <code>BRAccountLinkingManager.shared().getLinkedRetailers()</code> and iterate over the results looking for <code>BRAccountLinkingRetailerAmazon</code></td>
</tr>
<tr>
<td><code>[BRAmazonManager resetAmazonOrders]</code></td>
<td>Call <code>BRAccountLinkingManager.shared().resetHistory(for: .amazon)</code></td>
</tr>
<tr>
<td><code>[BRAmazonManager verifyAmazonAccount:]</code></td>
<td>Call <code>BRAccountLinkingManager.shared().verifyRetailer(with: connection, withCompletion: {}</code></td>
</tr>
<tr>
<td><code>[BRAmazonManager grabNewAmazonOrders:]</code></td>
<td>Call <code>BRAccountLinkingManager.shared().grabNewOrders(for: .amazonBeta) {}</code></td>
</tr>
</tbody></table>

<p>As noted above, the method for handling 2FA and other user-input scenarios is slightly different now. Whereas previously you would trap the error code <code>BRAmazonErrorVerificationNeeded</code> and then invoke <code>[BRAmazonManager showBrowserFromViewController:withCompletion:]</code>, the new paradigm is that <code>verifyRetailer</code> and <code>grabNewOrders</code> will return the error code <code>BRAccountLinkingErrorVerificationNeeded</code> <em>as well as</em> the actual view controller for you to display. Once the user has successfully authenticated, the same callback will be invoked with the code <code>BRAccountLinkingErrorVerificationCompleted</code> which is the trigger for you to dismiss the view controller.</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2025 <a class="link" href="https://www.blinkreceipt.com" target="_blank" rel="external noopener">BlinkReceipt LLC</a>. All rights reserved. (Last updated: 2025-07-17)</p>
      
    </section>
  </body>
</html>
